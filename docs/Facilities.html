<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2021-07-03" />

<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PPBEA</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="test.html">test</a>
</li>
<li>
  <a href="Facilities.html">Facilities</a>
</li>
<li>
  <a href="CatC.html">Cat C</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore"><div class="figure">
<img src="images/16_MCCSlogo_Comp.png" width="192" />

</div>
<p>MCCS Facilities Exploratory Analysis</p></h1>
<h4 class="date">03 July 2021</h4>

</div>


<pre class="r"><code># File Setup ----

library(tidyverse)
library(ggthemes)
library(ggrepel)
library(extrafont)
library(readxl)
library(DT)
library(gt)
library(DataExplorer)
library(tidyquant)
library(markdown)
library(writexl)


cat_codes &lt;- read_xlsx(&quot;/Users/barnesj/OneDrive - USMC-MCCS.ORG/Utilization/iNFADS/Data/MCCS_Facility_ Inventory_Report.XLSX&quot;,
  sheet = &quot;Cat_code&quot;,
  col_types = c(&quot;numeric&quot;, &quot;text&quot;, &quot;text&quot;, &quot;text&quot;)
)

fac &lt;- read_xlsx(&quot;/Users/barnesj/OneDrive - USMC-MCCS.ORG/Utilization/iNFADS/Data/MCCS_Facility_ Inventory_Report.XLSX&quot;,
  sheet = &quot;Facility&quot;,
  skip = 1,
  col_types = c(
    &quot;text&quot;, &quot;text&quot;, &quot;text&quot;, &quot;text&quot;, &quot;text&quot;,
    &quot;numeric&quot;, &quot;numeric&quot;, &quot;date&quot;, &quot;text&quot;, &quot;date&quot;,
    &quot;date&quot;
  )
)

# infads &lt;- read_rds(&quot;/Users/barnesj/OneDrive - USMC-MCCS.ORG/Utilization/iNFADS/Data/infads_clean&quot;) # read in the cleaned data

utl &lt;- read_xlsx(&quot;/Users/barnesj/OneDrive - USMC-MCCS.ORG/Utilization/iNFADS/Data/MCCS_Facility_ Inventory_Report.XLSX&quot;,
  sheet = &quot;Sheet1&quot;,
  skip = 1
)

fac &lt;- fac %&gt;%
  janitor::clean_names() %&gt;%
  separate(mccs_installation_name, c(&quot;num&quot;, &quot;installation&quot;), sep = 7) %&gt;%
  separate(i_nfads_predominant_current_use_category_code, c(&quot;usecode&quot;, &quot;usedesc&quot;), sep = 6) %&gt;%
  select(
    RPUID = i_nfads_real_property_unique_id,
    usecode,
    usedesc,
    installation,
    prv = i_nfads_current_prv,
    fci = i_nfads_facility_condition_index,
    fci_dt = i_nfads_fci_date,
    build_dt = i_nfads_facility_built_date
  ) %&gt;%
  # coverting dates to ymd format
  mutate(
    usecode = usecode %&gt;% as.numeric(),
    fci_dt = ymd(fci_dt) %&gt;% replace_na(ymd(0000 / 00 / 00)),
    build_dt = ymd(build_dt) %&gt;% replace_na(ymd(0000 / 00 / 00))
  ) %&gt;%
  # adding new column called Q-Rating based on the FCI
  mutate(q_rating = case_when(
    fci &lt;= 59 ~ &quot;Q4&quot;,
    fci &lt;= 79 ~ &quot;Q3&quot;,
    fci &lt;= 89 ~ &quot;Q2&quot;,
    TRUE ~ &quot;Q1&quot;
  )) %&gt;%
  # mutate(Category = Category %&gt;% replace_na(&quot;Z&quot;)) %&gt;%
  mutate(installation = case_when(
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;butler&quot;) ~ &quot;MCB Butler&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcb camp pendleton&quot;) ~ &quot;MCB Pendleton&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcb camp lejeune&quot;) ~ &quot;MCB Lejeune&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcb hawaii&quot;) ~ &quot;MCB Hawaii&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcas iwakuni&quot;) ~ &quot;MCAS Iwakuni&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcas cherry&quot;) ~ &quot;MCAS Cherry Point&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;marine corps base quantico&quot;) ~ &quot;MCB Quantico&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcagcc&quot;) ~ &quot;MCAGCC 29 Palms&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;miramar&quot;) ~ &quot;MCAS Miramar&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;yuma&quot;) ~ &quot;MCAS Yuma&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;san diego&quot;) ~ &quot;MCRD San Diego&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcrd beaufort&quot;) ~ &quot;MCRD PI&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;new river&quot;) ~ &quot;MCAS New River&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;futenma&quot;) ~ &quot;MCAS Futenma&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcas beaufort&quot;) ~ &quot;MCAS Beaufort&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;barstow&quot;) ~ &quot;MCLB Barstow&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;albany&quot;) ~ &quot;MCLB Albany&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;orleans&quot;) ~ &quot;MARFORRES&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;washington&quot;) ~ &quot;MBW (8th &amp; I)&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;garden&quot;) ~ &quot;Garden City&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;bridgeport&quot;) ~ &quot;MWTC Bridgeport&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mujuk&quot;) ~ &quot;Camp Mujuk&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcas camp pendleton&quot;) ~ &quot;MCAS Pendleton&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;allen&quot;) ~ &quot;Camp Elmore&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcsf&quot;) ~ &quot;MCSF Blount Island&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;4th mardiv&quot;) ~ &quot;HQ 4th MARDIV&quot;,
    installation %&gt;% str_to_lower() %&gt;% str_detect(&quot;mcsptact&quot;) ~ &quot;Kansas City&quot;
  )) %&gt;%
  mutate(RPUID = RPUID %&gt;% as.character()) %&gt;%
  mutate(RM = prv * 0.025)




`%notin%` &lt;- Negate(`%in%`)

utl &lt;- utl %&gt;%
  janitor::clean_names() %&gt;%
  janitor::remove_empty(c(&quot;rows&quot;), quiet = TRUE) %&gt;%
  select(
    RPUID = i_nfads_real_property_unique_id,
    use = i_nfads_use_category_code,
    fac_num = i_nfads_facility_number,
    installation = mccs_installation_name,
    program = mccs_business_program,
    asset_name = i_nfads_real_property_asset_name,
    fac_use = i_nfads_facility_use,
    FY2022 = fsm_fy22_sustainment_cost,
    Cat = i_nfads_naf_category,
    adq = i_nfads_adq_area_measure,
    sub = i_nfads_sub_area_measure,
    iadq = i_nfads_iadq_area_measure,
    adq_alt = i_nfads_adq_alternate_measure,
    sub_alt = i_nfads_sub_alternate_measure,
    iadq_alt = i_nfads_iadq_alternate_measure,
    adq_other = i_nfads_adq_other_measure,
    sub_other = i_nfads_sub_other_measure,
    iadq_other = i_nfads_iadq_other_measure
  ) %&gt;%
  separate(use, into = c(&quot;use_code&quot;, &quot;use_desc&quot;), sep = 6) %&gt;%
  mutate(use_code = use_code %&gt;% as.numeric()) %&gt;%
  # Remove divestments
  filter(RPUID %notin% c(
    21104, 54390, 25139, 24922, 18187, 21378, 21379, 43713, 43714, 35068, 35073, 35080,
    33751, 38891, 38889, 38895, 47139, 40535, 43543, 43544, 43744, 40524, 40529,
    40532, 40526, 40534, 47876, 46374, 39594, 54613
  )) %&gt;%
  mutate(
    adq = adq %&gt;% replace_na(0),
    sub = sub %&gt;% replace_na(0),
    iadq = iadq %&gt;% replace_na(0),
    adq_other = adq_other %&gt;% replace_na(0),
    sub_other = sub_other %&gt;% replace_na(0),
    iadq_other = iadq_other %&gt;% replace_na(0),
    adq_alt = adq_alt %&gt;% replace_na(0),
    sub_alt = sub_alt %&gt;% replace_na(0),
    iadq_alt = iadq_alt %&gt;% replace_na(0),
    FY2022 = FY2022 %&gt;% replace_na(0)
  ) %&gt;%
  mutate(total_measure = adq + sub + iadq,
         alt_total_measure = adq_alt + sub_alt + iadq_alt,
         other_total_measure = adq_other + sub_other + iadq_other) %&gt;%
  group_by(RPUID) %&gt;%

  mutate(use_pct_area = total_measure / sum(total_measure),
         use_pct_other = other_total_measure / sum(other_total_measure),
         use_pct_alt = alt_total_measure / sum(alt_total_measure),
         use_pct_area = use_pct_area %&gt;% replace_na(0),
         use_pct_alt = use_pct_alt %&gt;% replace_na(0),
         use_pct_other = use_pct_other %&gt;% replace_na(0)) %&gt;%
  
  mutate(fac_use_pct = if_else(use_pct_area &gt; 0, use_pct_area, 
                               if_else(use_pct_alt &gt; 0, use_pct_alt, use_pct_other))) %&gt;% 
  ungroup() %&gt;%
  mutate(region = case_when(
    installation %in% c(
      &quot;M00146 MCAS CHERRY POINT NC&quot;,
      &quot;M00263 MCRD BEAUFORT PI SC&quot;,
      &quot;M60169 MCAS BEAUFORT SC&quot;,
      &quot;M62573 MCAS NEW RIVER JAX NC&quot;,
      &quot;M67001 MCB CAMP LEJEUNE NC&quot;,
      &quot;M67004 MCLB ALBANY GA&quot;,
      &quot;M67695 MCSF BLOUNT ISLAND&quot;
    ) ~ &quot;MCIEAST&quot;,
    installation %in% c(
      &quot;M00264 MARINE CORPS BASE QUANTICO VA&quot;,
      &quot;M67029 MARBKS WASHINGTON DC&quot;
    ) ~ &quot;MCINCR&quot;,
    installation %in% c(
      &quot;M00318 MCB HAWAII KANEOHE&quot;,
      &quot;M20810 CAMP MUJUK REPUBLIC OF KOREA&quot;,
      &quot;M63026 MCAS FUTENMA JA&quot;,
      &quot;M67400 MCB CAMP S D BUTLER OKINAWA JA&quot;,
      &quot;M62613 MCAS IWAKUNI JA&quot;
    ) ~ &quot;MCIPAC&quot;,
    installation %in% c(
      &quot;M00681 MCB CAMP PENDLETON CA&quot;,
      &quot;M62204 MCLB BARSTOW CA&quot;,
      &quot;M62974 MCAS YUMA AZ&quot;,
      &quot;M67604 MCAS CAMP PENDLETON CA&quot;,
      &quot;M67865 MCAS MIRAMAR&quot;
    ) ~ &quot;MCIWEST&quot;,
    installation %in% c(
      &quot;M00243 MARCORPRCUITDEP SAN DIEGO CA&quot;,
      &quot;M64495 MARCORPSMWTC BRIDGEPORT CA&quot;,
      &quot;M67399 MCAGCC TWENTYNINE PALMS CA&quot;
    ) ~ &quot;SLTI&quot;,
    installation %in% c(
      &quot;M09036 CAMP ALLEN&quot;,
      &quot;M67011 MARCORPS DIST 1 GARDEN CITY NY&quot;,
      &quot;M67386 MCSPTACT KANSAS CITY MO&quot;,
      &quot;M67861 MARCORRESFOR NEW ORLEANS LA&quot;,
      &quot;M68479 HDQTRS 4TH MARDIV NEW ORLEANS&quot;
    ) ~ &quot;NONE&quot;
  )) %&gt;%
  mutate(RPUID = RPUID %&gt;% as.character())

fac_mapped &lt;- utl %&gt;%
  inner_join(cat_codes, by = c(&quot;use_code&quot; = &quot;use_code&quot;)) 
 

fac_mapped &lt;- fac_mapped %&gt;%
  left_join(fac, by = &quot;RPUID&quot;) %&gt;% 
  filter(naf_cat %in% c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;L&quot;))

# RPUID_count &lt;- fac_mapped %&gt;%
#   group_by(RPUID) %&gt;%
#   count(RPUID)
# 
# fac_mapped &lt;- fac_mapped %&gt;%
#   inner_join((RPUID_count))


df_clean &lt;- fac_mapped %&gt;%
  mutate(
    sus = if_else(naf_cat == &quot;C&quot;, FY2022 * 2, FY2022),
    sus = sus %&gt;% replace_na(0)
  ) %&gt;%
  mutate(
    RM_corrected = RM * fac_use_pct) 


df_final &lt;- df_clean %&gt;%
  select(region, installation = installation.x, RPUID, use_code, use_desc, usedesc, naf_cat, op_activity, fac_num, facility_desc, asset_name, fci, fci_dt, q_rating, build_dt, adq, sub, iadq, total_measure, adq_alt, sub_alt, sub_other, alt_total_measure, adq_other, sub_other, iadq_other, other_total_measure, use_pct_area, use_pct_alt, use_pct_other, fac_use_pct, prv, RM, RM_corrected, sus)

write_xlsx(df_final, path = &quot;/Users/barnesj/OneDrive - USMC-MCCS.ORG/Utilization/iNFADS/Data/df_finalv3.xlsx&quot;)</code></pre>
<p><br><br></p>
<div id="exploring-costs" class="section level4">
<h4>Exploring Costs</h4>
<pre class="r"><code>category &lt;- df_final %&gt;%
  group_by(naf_cat) %&gt;%
  summarise(
    total_sus = sum(sus),
    total_rm = sum(RM_corrected),
    total = sum(sus) + sum(RM_corrected)
  ) %&gt;%
  arrange(desc(total)) %&gt;%
  janitor::adorn_totals()

category</code></pre>
<pre><code>##  naf_cat total_sus  total_rm     total
##        C  72570986 120040348 192611334
##        A  25695011  88802160 114497172
##        B  18183573  44002558  62186131
##        L  11446488  29944762  41391250
##    Total 127896057 282789829 410685886</code></pre>
<p><br><br></p>
<pre class="r"><code>region &lt;- df_final %&gt;%
  group_by(region) %&gt;%
  summarise(
    total_sus = sum(sus),
    total_rm = sum(RM_corrected),
    total = sum(sus) + sum(RM_corrected)
  ) %&gt;%
  arrange(desc(total)) %&gt;%
  janitor::adorn_totals()

region</code></pre>
<pre><code>##   region   total_sus  total_rm     total
##   MCIPAC  49129796.2 107857413 156987209
##  MCIEAST  29301336.3  78408898 107710234
##  MCIWEST  30908358.3  46197514  77105872
##     SLTI  11654129.9  19120407  30774537
##   MCINCR   6232067.3  23673522  29905589
##     NONE    670369.3   7532075   8202444
##    Total 127896057.4 282789829 410685886</code></pre>
<p><br><br></p>
<pre class="r"><code>program &lt;- df_final %&gt;%
  group_by(op_activity) %&gt;%
  summarise(
    total_sus = sum(sus),
    total_rm = sum(RM_corrected),
    total = sum(sus) + sum(RM_corrected)
  ) %&gt;%
  arrange(desc(total)) %&gt;%
  janitor::adorn_totals()

program</code></pre>
<pre><code>##                op_activity   total_sus  total_rm     total
##        Semper Fit Programs  21031441.9  75525342  96556784
##        Exchange Operations  31407372.8  39522473  70929846
##   Food &amp; Beverage (Direct)   8390116.1  52345280  60735396
##   Marine &amp; Family Programs  12400073.9  33274964  45675038
##                      Clubs  19884399.1  22394064  42278463
##                    Lodging  11446487.8  29944762  41391250
##      Commercial Recreation  16074501.9  13782553  29857055
##  Children &amp; Youth Programs   6430689.6  12803731  19234421
##  Other Business Operations    830974.4   3196660   4027634
##                      Total 127896057.4 282789829 410685886</code></pre>
<p><br><br></p>
<div id="exploring-square-footage" class="section level5">
<h5>Exploring Square Footage</h5>
<p><br><br></p>
<pre class="r"><code>program_decade_sqft &lt;- df_final %&gt;%
  mutate(decade = floor_date(build_dt, years(10)) %&gt;% year()) %&gt;%
  group_by(decade, op_activity) %&gt;%
  summarise(total = sum(total_measure)) %&gt;%
  mutate(decade = if_else(is.na(decade), 2020, decade)) %&gt;%
  ggplot(aes(decade, total)) +
  geom_line() +
  # geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  facet_wrap(~op_activity, scales = &quot;free_y&quot;) +
  theme_clean() +
  scale_y_continuous(labels = scales::number) +
  labs(
    y = &quot;Total Measure (SqFt)&quot;,
    x = &quot;Decade&quot;,
    title = &quot;What is the sqft added in each decade by Program?&quot;,
    subtitle = &quot;Decade is based on build date&quot;
  )

program_decade_sqft</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-5-1.png" width="960" /> <br><br></p>
<pre class="r"><code>program_year_sqft &lt;- df_final %&gt;%
  mutate(year = floor_date(build_dt, years(1)) %&gt;% year()) %&gt;%
  group_by(year, op_activity) %&gt;%
  filter(year &gt;= 1980, year &lt;= 2020) %&gt;%
  summarise(total = sum(total_measure)) %&gt;%
  # mutate(decade = if_else(is.na(year), 2020, decade)) %&gt;%
  ggplot(aes(year, total)) +
  geom_col() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  facet_wrap(~op_activity, scales = &quot;free&quot;) +
  theme_tq() +
  scale_y_continuous(labels = scales::number) +
  # scale_x_continuous(breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  labs(
    y = &quot;Total Measure (SqFt)&quot;,
    x = &quot;Year&quot;,
    title = &quot;What is the sqft added each year by Program?&quot;,
    subtitle = &quot;Year is based on build date of facility&quot;
  )

program_year_sqft</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-6-1.png" width="960" /> <br><br></p>
<pre class="r"><code>region_year_sqft &lt;- df_final %&gt;%
  mutate(year = floor_date(build_dt, years(1)) %&gt;% year()) %&gt;%
  group_by(year, region) %&gt;%
  filter(year &gt;= 1980, year &lt;= 2020) %&gt;%
  summarise(total = sum(total_measure)) %&gt;%
  filter(region != &quot;NONE&quot;) %&gt;%
  # mutate(decade = if_else(is.na(year), 2020, decade)) %&gt;%
  ggplot(aes(year, total)) +
  geom_col() +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  facet_wrap(~region, scales = &quot;free&quot;) +
  theme_tq() +
  scale_y_continuous(labels = scales::number) +
  # scale_x_continuous(breaks = c(1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2020)) +
  labs(
    y = &quot;Total Measure (SqFt)&quot;,
    x = &quot;Year&quot;,
    title = &quot;What is the total measure of sqft by Region in a given year?&quot;,
    subtitle = &quot;Year is based on build date of facility&quot;
  )

region_year_sqft</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-7-1.png" width="960" /> <br><br></p>
<pre class="r"><code>scale &lt;- seq(1900, 2020, by = 10)


df_final %&gt;%
  mutate(decade = floor_date(build_dt, years(10)) %&gt;% year()) %&gt;%
  group_by(decade) %&gt;%
  summarise(sqft = sum(total_measure)) %&gt;%
  mutate(decade = decade %&gt;% as.double(),
         decade = if_else(is.na(decade), 2020, decade)) %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(decade, sqft)) +
  geom_col(fill = &quot;#2c3e50&quot;) +
  scale_x_continuous(breaks = scale) +
  theme_clean() +
  labs(
    title = &quot;New Square Footage by Decade&quot;,
    subtitle = &quot;Based on Facilities Build Date&quot;,
    y = &quot;SQFT&quot;,
    x = &quot;Decade&quot;
  )</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-8-1.png" width="960" /></p>
<pre class="r"><code>df_final %&gt;%
  mutate(decade = floor_date(build_dt, years(10)) %&gt;% year()) %&gt;%
  group_by(decade) %&gt;%
  summarise(sqft = sum(total_measure)) %&gt;%
  ungroup() %&gt;%
  mutate(decade = decade %&gt;% as.double(),
         decade = if_else(is.na(decade), 2020, decade), 
    cumulative = cumsum(sqft)
  ) %&gt;%
  ggplot(aes(decade, cumulative)) +
  geom_area(fill = &quot;#2c3e50&quot;) +
  scale_x_continuous(breaks = scale) +
  scale_y_continuous(labels = scales::number_format()) +
  theme_clean() +
  labs(
    title = &quot;Cumulative New Square Footage&quot;,
    subtitle = &quot;Based on Facilities Build Date&quot;,
    y = &quot;SQFT&quot;,
    x = &quot;Decade&quot;
  )</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-8-2.png" width="960" /></p>
<p><br><br></p>
<pre class="r"><code>total_sq_by_region &lt;- df_final %&gt;%
  group_by(region) %&gt;%
  summarise(total_sqft = sum(total_measure)) %&gt;% 
  arrange(desc(total_sqft)) %&gt;% 
  mutate(region = region %&gt;% fct_reorder(total_sqft)) %&gt;% 
  ggplot(aes(region, total_sqft)) +
  geom_col(fill = &quot;#2c3e50&quot;) +
  coord_flip() +
  theme_clean() +
  scale_y_continuous(labels = scales::number) +
  labs(
    title = &quot;Total Square Footage by Region&quot;,
    y = &quot;Total SqFt&quot;,
    x = &quot;Region&quot;
  )

total_sq_by_region</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-9-1.png" width="960" /></p>
<p><br><br></p>
<pre class="r"><code>total_sq_by_installation &lt;- df_final %&gt;%
  group_by(installation) %&gt;%
  summarise(total_sqft = sum(total_measure)) %&gt;% 
  arrange(desc(total_sqft)) %&gt;% 
  mutate(installation = installation %&gt;% fct_reorder(total_sqft)) %&gt;% 
  ggplot(aes(installation, total_sqft)) + 
  geom_col(fill = &quot;#2c3e50&quot;) +
  coord_flip() +
  theme_clean() +
   labs(
    title = &quot;Total Square Footage by Installation&quot;,
    y = &quot;Total SQFT&quot;,
    x = &quot;Installation&quot;
  )

# %&gt;% 
#   gt() %&gt;% 
#   tab_header(title = &quot;Total Sqaure Foot by Instllation&quot;) %&gt;% 
#   fmt_number(columns = 2 ,
#              decimals = 0,
#              sep_mark = &quot;,&quot;,
#              use_seps = TRUE)

total_sq_by_installation</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-10-1.png" width="960" /></p>
<p><br><br></p>
</div>
</div>
<div id="exploring-q-rating" class="section level4">
<h4>Exploring Q-Rating</h4>
<p><br><br></p>
<pre class="r"><code>q_group &lt;- df_final %&gt;% distinct(RPUID, .keep_all = TRUE)

op_activity_q &lt;- q_group %&gt;% 
  group_by(op_activity) %&gt;% 
  count(q_rating) %&gt;% 
  mutate(q_rating_pct = n / sum(n))

op_activity_q</code></pre>
<pre><code>## # A tibble: 36 x 4
## # Groups:   op_activity [9]
##    op_activity               q_rating     n q_rating_pct
##    &lt;chr&gt;                     &lt;chr&gt;    &lt;int&gt;        &lt;dbl&gt;
##  1 Children &amp; Youth Programs Q1         135       0.572 
##  2 Children &amp; Youth Programs Q2          83       0.352 
##  3 Children &amp; Youth Programs Q3          15       0.0636
##  4 Children &amp; Youth Programs Q4           3       0.0127
##  5 Clubs                     Q1          14       0.230 
##  6 Clubs                     Q2          23       0.377 
##  7 Clubs                     Q3          22       0.361 
##  8 Clubs                     Q4           2       0.0328
##  9 Commercial Recreation     Q1         169       0.357 
## 10 Commercial Recreation     Q2         218       0.461 
## # ... with 26 more rows</code></pre>
<p><br><br></p>
<pre class="r"><code>cat_q &lt;- q_group %&gt;% 
  group_by(naf_cat) %&gt;% 
  count(q_rating) %&gt;% 
  mutate(q_rating_pct = n / sum(n))

cat_q</code></pre>
<pre><code>## # A tibble: 16 x 4
## # Groups:   naf_cat [4]
##    naf_cat q_rating     n q_rating_pct
##    &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;        &lt;dbl&gt;
##  1 A       Q1         468       0.506 
##  2 A       Q2         304       0.329 
##  3 A       Q3         130       0.141 
##  4 A       Q4          23       0.0249
##  5 B       Q1         662       0.525 
##  6 B       Q2         417       0.330 
##  7 B       Q3         154       0.122 
##  8 B       Q4          29       0.0230
##  9 C       Q1         351       0.405 
## 10 C       Q2         353       0.407 
## 11 C       Q3         136       0.157 
## 12 C       Q4          27       0.0311
## 13 L       Q1          17       0.198 
## 14 L       Q2          52       0.605 
## 15 L       Q3          16       0.186 
## 16 L       Q4           1       0.0116</code></pre>
<p><br><br></p>
<pre class="r"><code>region_q &lt;- q_group %&gt;% 
  group_by(region) %&gt;% 
  count(q_rating) %&gt;% 
  mutate(q_rating_pct = n / sum(n))  
# %&gt;% 
#   gt() %&gt;% 
#    tab_header(title = &quot;Exploring Q-Rating by Region&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

region_q</code></pre>
<pre><code>## # A tibble: 24 x 4
## # Groups:   region [6]
##    region  q_rating     n q_rating_pct
##    &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt;        &lt;dbl&gt;
##  1 MCIEAST Q1         531       0.464 
##  2 MCIEAST Q2         423       0.369 
##  3 MCIEAST Q3         160       0.140 
##  4 MCIEAST Q4          31       0.0271
##  5 MCINCR  Q1          36       0.321 
##  6 MCINCR  Q2          40       0.357 
##  7 MCINCR  Q3          34       0.304 
##  8 MCINCR  Q4           2       0.0179
##  9 MCIPAC  Q1         246       0.402 
## 10 MCIPAC  Q2         248       0.405 
## # ... with 14 more rows</code></pre>
<p><br><br></p>
<pre class="r"><code>installation_q &lt;- q_group %&gt;% 
  group_by(installation) %&gt;% 
  count(q_rating) %&gt;% 
  mutate(q_rating_pct = n / sum(n)) 
# %&gt;% 
#   gt() %&gt;% 
#    tab_header(title = &quot;Exploring Q-Rating by Installation&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

installation_q</code></pre>
<pre><code>## # A tibble: 85 x 4
## # Groups:   installation [27]
##    installation                        q_rating     n q_rating_pct
##    &lt;chr&gt;                               &lt;chr&gt;    &lt;int&gt;        &lt;dbl&gt;
##  1 M00146 MCAS CHERRY POINT NC         Q1          67       0.475 
##  2 M00146 MCAS CHERRY POINT NC         Q2          48       0.340 
##  3 M00146 MCAS CHERRY POINT NC         Q3          23       0.163 
##  4 M00146 MCAS CHERRY POINT NC         Q4           3       0.0213
##  5 M00243 MARCORPRCUITDEP SAN DIEGO CA Q1          12       0.2   
##  6 M00243 MARCORPRCUITDEP SAN DIEGO CA Q2          30       0.5   
##  7 M00243 MARCORPRCUITDEP SAN DIEGO CA Q3          18       0.3   
##  8 M00263 MCRD BEAUFORT PI SC          Q1          27       0.257 
##  9 M00263 MCRD BEAUFORT PI SC          Q2          54       0.514 
## 10 M00263 MCRD BEAUFORT PI SC          Q3          19       0.181 
## # ... with 75 more rows</code></pre>
<p><br><br></p>
<div id="exploring-the-age-of-facilities" class="section level5">
<h5>Exploring the age of facilities</h5>
<p><br><br></p>
<pre class="r"><code>age_q &lt;- df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  group_by(q_rating) %&gt;% 
  summarise(avg_age = round(mean(age),0),
            median_age = round(median(age),0),
            sd_age = round(sd(age),0),
            max_age = max(age),
            min_age = min(age),
            range_age = max_age - min_age)
# %&gt;% 
#   gt() %&gt;% 
#   tab_header(title = &quot;Exlploring Facility Age by Q-Rating&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

age_q</code></pre>
<pre><code>## # A tibble: 4 x 7
##   q_rating avg_age median_age sd_age max_age min_age range_age
##   &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Q1            16         11     11      80       3        77
## 2 Q2            42         40     21     121       3       118
## 3 Q3            58         60     19     103       3       100
## 4 Q4            57         61     21     103      10        93</code></pre>
<p><br><br></p>
<pre class="r"><code>df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  mutate(q_rating = q_rating %&gt;% fct_reorder(age)) %&gt;% 
  ggplot(aes(age, q_rating)) + 
  geom_boxplot() +
  theme_clean() +
  scale_x_reverse() +
  labs(title = &quot;Facility Age by Q-Rating&quot;,
       x = &quot;Age&quot;,
       y = &quot;Q-Rating&quot;)</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-16-1.png" width="960" /></p>
<p><br><br></p>
<pre class="r"><code>program_age &lt;- df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  group_by(op_activity) %&gt;% 
  summarise(avg_age = round(mean(age),0),
            median_age = round(median(age),0),
            sd_age = round(sd(age),0),
            max_age = max(age),
            min_age = min(age),
            range_age = max_age - min_age) 
# %&gt;% 
#   gt() %&gt;% 
#   tab_header(title = &quot;Exlploring Facility Age by Program&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

program_age</code></pre>
<pre><code>## # A tibble: 9 x 7
##   op_activity               avg_age median_age sd_age max_age min_age range_age
##   &lt;chr&gt;                       &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 Children &amp; Youth Programs      21         14     18      90       3        87
## 2 Clubs                          51         55     25     113       3       110
## 3 Commercial Recreation          33         24     22     101       3        98
## 4 Exchange Operations            34         26     25     103       3       100
## 5 Food &amp; Beverage (Direct)       37         34     23     100       3        97
## 6 Lodging                        47         47     24     113       5       108
## 7 Marine &amp; Family Programs       30         23     22     121       3       118
## 8 Other Business Operations      37         30     25      79       3        76
## 9 Semper Fit Programs            34         29     24     103       3       100</code></pre>
<p><br><br></p>
<pre class="r"><code>df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  mutate(op_activity = op_activity %&gt;% fct_reorder(age)) %&gt;% 
  ggplot(aes(age, op_activity)) + 
  geom_boxplot() +
  theme_clean() +
  scale_x_reverse() +
  labs(title = &quot;Facility Age by Program&quot;,
       x = &quot;Age&quot;,
       y = &quot;Program&quot;)</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-18-1.png" width="960" /></p>
<p><br><br></p>
<pre class="r"><code>region_age &lt;- df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  group_by(region) %&gt;% 
  summarise(avg_age = round(mean(age),0),
            median_age = round(median(age),0),
            sd_age = round(sd(age),0),
            max_age = max(age),
            min_age = min(age),
            range_age = max_age - min_age) 
# %&gt;% 
#   gt() %&gt;% 
#   tab_header(title = &quot;Exlploring Facility Age by Region&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

region_age</code></pre>
<pre><code>## # A tibble: 6 x 7
##   region  avg_age median_age sd_age max_age min_age range_age
##   &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
## 1 MCIEAST      33         24     24     121       3       118
## 2 MCINCR       44         42     28     113       6       107
## 3 MCIPAC       35         31     23      81       3        78
## 4 MCIWEST      28         22     21      79       3        76
## 5 NONE         38         37     28      98       3        95
## 6 SLTI         40         33     28     100       5        95</code></pre>
<p><br><br></p>
<pre class="r"><code>df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  mutate(region = region %&gt;% fct_reorder(age)) %&gt;% 
  ggplot(aes(age, region)) + 
  geom_boxplot() +
  theme_clean() +
  scale_x_reverse() +
  labs(title = &quot;Facility Age by Region&quot;,
       x = &quot;Age&quot;,
       y = &quot;Region&quot;)</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-20-1.png" width="960" /></p>
<p><br><br></p>
<pre class="r"><code>installation_age &lt;- df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  group_by(installation) %&gt;% 
  summarise(avg_age = round(mean(age),0),
            median_age = round(median(age),0),
            sd_age = round(sd(age),0),
            max_age = max(age),
            min_age = min(age),
            range_age = max_age - min_age)
# %&gt;% 
#   gt() %&gt;% 
#   tab_header(title = &quot;Exlploring Facility Age by Installation&quot;) %&gt;% 
#   cols_align(align = c(&quot;center&quot;))

installation_age</code></pre>
<pre><code>## # A tibble: 27 x 7
##    installation              avg_age median_age sd_age max_age min_age range_age
##    &lt;chr&gt;                       &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
##  1 M00146 MCAS CHERRY POINT~      39         34     24      79       5        74
##  2 M00243 MARCORPRCUITDEP S~      59         70     33     100       5        95
##  3 M00263 MCRD BEAUFORT PI ~      43         42     28     121       3       118
##  4 M00264 MARINE CORPS BASE~      45         42     27     103       6        97
##  5 M00318 MCB HAWAII KANEOHE      48         47     24      80       6        74
##  6 M00681 MCB CAMP PENDLETO~      27         19     20      79       4        75
##  7 M09036 CAMP ALLEN              37         37     18      76      12        64
##  8 M20810 CAMP MUJUK REPUBL~      16         17      2      17      11         6
##  9 M60169 MCAS BEAUFORT SC        31         25     20      78       4        74
## 10 M62204 MCLB BARSTOW CA         35         26     21      79       6        73
## # ... with 17 more rows</code></pre>
<p><br><br></p>
<pre class="r"><code>df_final %&gt;% 
  mutate(age = today() - build_dt,
         age = round(age/365,0),
         age = age %&gt;% as.numeric()) %&gt;% 
  filter(!is.na(build_dt)) %&gt;% 
  mutate(installation = installation %&gt;% fct_reorder(age)) %&gt;% 
  ggplot(aes(age, installation)) + 
  geom_boxplot() +
  theme_clean() +
  scale_x_reverse() +
  labs(title = &quot;Facility Age by Installation&quot;,
       x = &quot;Age&quot;,
       y = &quot;Installation&quot;)</code></pre>
<p><img src="Facilities_files/figure-html/unnamed-chunk-22-1.png" width="960" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
